# NetMedEx 

NetMedEx is a tool developed in Python to extract BioConcept entities (e.g., genes, diseases, chemicals, and species) from the Pubtator file generated by [Pubtator3](https://www.ncbi.nlm.nih.gov/research/pubtator3/). NetMedEx calculates the frequency of each BioConcept pair (e.g., gene-gene, gene-chemical, chemical-disease) based on co-mentions in publications, and generates a co-mention interaction network for these BioConcept entities. The network can be viewed in a browser or imported into [Cytoscape](https://cytoscape.org/) for visualization and further network analysis.

## Getting Started

For more, see the [documentation]().

NetMedEx can be used from:  
1) [Web application (docker)](#docker)  
2) [Web application (local)](#web-app)
3) [Command-line interface](#cli) 


### Web Application (Docker)

If you have Docker installed, you can run the following command, then open `localhost:8050` in your browser:

```
docker run -p 8050:8050 --rm lsbnb/netmedex 
```
### Installation

To use the NetMedEx web app or CLI, you need to install the following package from PyPI:

```
pip install netmedex
```

*Note: NetMedEx requires Python version >= 3.11*

#### Web Application (Local)

[Install netmedex first](#installation)

Run the following command, then open `localhost:8050` in your browser:
```
netmedex run
```

The parameters in the sidebar are described in [Available Commands](#available-commands).

### CLI

[Install netmedex first](#installation)

#### Examples

**Search articles containing biological concepts of interest via [PubTator3 API](https://www.ncbi.nlm.nih.gov/research/pubtator3/api):**   

```
# Query with keywords
netmedex search -q "N-dimethylnitrosamine and Metformin" [-o OUTPUT_FILEPATH]

# Query with article PMIDs
netmedex search -p 34895069,35883435,34205807 [-o OUTPUT_FILEPATH]

# Query with article PMIDs (from file)
netmedex search -f examples/pmids.txt [-o OUTPUT_FILEPATH]

# Query with PubTator3 Entity ID (See PubTator3 instructions)
netmedex search -q "@DISEASE_COVID_19 AND @GENE_PON1" [-o OUTPUT_FILEPATH]
```

**Generate co-mention networks**
  
```
# Use default parameters and set edge weight cutoff to 1
netmedex network -i examples/pmids_output.pubtator -o pmids_output.html -w 1

# Keep MeSH terms and discard non-MeSH terms
netmedex network -i examples/pmids_output.pubtator -o pmids_output.html -w 1 --node_type mesh

# Keep confident relations between entities (see PubTator3 for the detection of "relation")
netmedex network -i examples/pmids_output.pubtator -o pmids_output.html -w 1 --node_type relation

# Save the result in XGMML format for further processing in Cytoscape
netmedex network -i examples/pmids_output.pubtator -o pmids_output.xgmml -w 1 -f xgmml

# Use normalized pointwise mutual information (NPMI) to weight edges
netmedex network -i examples/pmids_output.pubtator -o pmids_output.html -w 5 --weighting_method npmi
```

**View the network**

HTML: Open it in your browser to view the network.  
XGMML: Import the file into Cytoscape to view the network.

For further usage, please refer to [documentation]().

## Available Commands

### netmedex
```
usage: netmedex [-h] {search,network,run} ...

positional arguments:
  {search,network,run}
    search              Search PubMed articles and obtain annotations
    network             Build a network from annotations
    run                 Run NetMedEx app

options:
  -h, --help            show this help message and exit
```

### netmedex search
```
usage: netmedex search [-h] [-q QUERY] [-o OUTPUT] [-p PMIDS] [-f PMID_FILE] [-s {score,date}] [--max_articles MAX_ARTICLES] [--full_text]
                       [--use_mesh] [--debug]

options:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        Query string
  -o OUTPUT, --output OUTPUT
                        Output path (default: [CURRENT_DIR].pubtator)
  -p PMIDS, --pmids PMIDS
                        PMIDs for the articles (comma-separated)
  -f PMID_FILE, --pmid_file PMID_FILE
                        Filepath to load PMIDs (one per line)
  -s {score,date}, --sort {score,date}
                        Sort articles in descending order by (default: date)
  --max_articles MAX_ARTICLES
                        Maximal articles to request from the searching result (default: 1000)
  --full_text           Collect full-text annotations if available
  --use_mesh            Use MeSH vocabulary instead of the most commonly used original text in articles
  --debug               Print debug information
```

### netmedex network
```
usage: netmedex network [-h] [-i INPUT] [-o OUTPUT] [-w CUT_WEIGHT] [-f {xgmml,html,json}] [--node_type {all,mesh,relation}]
                        [--weighting_method {freq,npmi}] [--pmid_weight PMID_WEIGHT] [--debug] [--community] [--max_edges MAX_EDGES]

options:
  -h, --help            show this help message and exit
  -i INPUT, --input INPUT
                        Path to the pubtator file
  -o OUTPUT, --output OUTPUT
                        Output path (default: [INPUT_DIR].[FORMAT_EXT])
  -w CUT_WEIGHT, --cut_weight CUT_WEIGHT
                        Discard the edges with weight smaller than the specified value (default: 2)
  -f {xgmml,html,json}, --format {xgmml,html,json}
                        Output format (default: html)
  --node_type {all,mesh,relation}
                        Keep specific types of nodes (default: all)
  --weighting_method {freq,npmi}
                        Weighting method for network edge (default: freq)
  --pmid_weight PMID_WEIGHT
                        CSV file for the weight of the edge from a PMID (default: 1)
  --debug               Print debug information
  --community           Divide nodes into distinct communities by the Louvain method
  --max_edges MAX_EDGES
                        Maximum number of edges to display (default: 0, no limit)
```
