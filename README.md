# Pub3ToCytoscape

## Description

Pub3ToCytoscape is a tool developed in Python to extract BioConcept entities (e.g., genes, diseases, chemicals, and species) from the Pubtator file generated by [Pubtator3](https://www.ncbi.nlm.nih.gov/research/pubtator3/). Pub3ToCytoscape calculates the frequency of each BioConcept pair (e.g., gene-gene, gene-chemical, chemical-disease) based on co-mentions in publications, and generates a co-mention interaction network for these BioConcept entities. The network can be imported into [Cytoscape](https://cytoscape.org/) for visualization and further network analyses.

## Installation 

1. Clone this repository.
```
git clone https://github.com/yehzx/Pub3ToCytoscape.git
cd Pub3ToCytoscape
```

2. Create a new environment and install PubTator3ToCytoscape.
```
conda create -n pubtoscape python=3.11
conda activate pubtoscape

# Install CLI only
pip install .

# Include web app
pip install .[dash]
```

## Example Usage

### Web App

Run the following command, then open the address in your browser:
```
python pubtoscape_app/app.py
```

The parameters in the sidebar are described in [Available Commands](#available-commands)

*Note:*
  1. Some specific combinations, such as exporting community networks as XGMML files, are not yet supported.
  2. Dynamic graph visualization (e.g., adjusting edge weight cutoff, minimal node degree, layout, etc.) sometimes encounter errors due to potential state management issues. Please refresh the page and try again with the same set of parameters.


### CLI

1. Get a PubTator file generated from fetching related articles by using [PubTator3 API](https://www.ncbi.nlm.nih.gov/research/pubtator3/api)  

```
# Query with keywords
pubtator3 -q "N-dimethylnitrosamine and Metformin" [-o OUTPUT_FILEPATH]

# Query with article PMIDs
pubtator3 -p 34895069,35883435,34205807 [-o OUTPUT_FILEPATH]

# Query with article PMIDs (from file)
pubtator3 -f examples/pmids.txt [-o OUTPUT_FILEPATH]

# Query with PubTator3 Entity ID (See PubTator3 instructions)
pubtator3 -q "@DISEASE_COVID_19 AND @GENE_PON1" [-o OUTPUT_FILEPATH]
```

2. Generate Cytoscape networks
  
```
# Use default parameters and set edge weight cutoff to 1
tocytoscape -i examples/pmids_output.pubtator -o pmids_output.html -w 1

# Keep MeSH terms and discard non-MeSH terms
tocytoscape -i examples/pmids_output.pubtator -o pmids_output.html -w 1 --node_type mesh

# Keep confident relations between entities (see PubTator3 for the detection of "relation")
tocytoscape -i examples/pmids_output.pubtator -o pmids_output.html -w 1 --node_type relation

# Save the result in XGMML format for further processing in Cytoscape
tocytoscape -i examples/pmids_output.pubtator -o pmids_output.html -w 1 -f xgmml

# Use normalized pointwise mutual information (NPMI) to weight edges
tocytoscape -i examples/pmids_output.pubtator -o pmids_output.html -w 5 --weighting_method npmi
```

3. Depends on your output format:  
    HTML: Open it in your browser to view the network.  
    XGMML: Import the file into Cytoscape to view the network.

For further usage, please refer to `notebooks`.

## Available Commands

### pubtator3
```
usage: pubtator3 [-h] [-q QUERY] [-o OUTPUT] [-p PMIDS] [-f PMID_FILE] [--max_articles MAX_ARTICLES] [--full_text] [--use_mesh] [--debug]

options:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        Query string
  -o OUTPUT, --output OUTPUT
                        Output path
  -p PMIDS, --pmids PMIDS
                        PMIDs for the articles (comma-separated)
  -f PMID_FILE, --pmid_file PMID_FILE
                        Filepath to load PMIDs
  --max_articles MAX_ARTICLES
                        Maximal articles to request from the searching result (default: 1000)
  --full_text           Collect full-text annotations if available
  --use_mesh            Use MeSH vocabulary instead of the most commonly used original text in articles
  --debug               Print debug information
```

### tocytoscape
```
usage: tocytoscape [-h] [-i INPUT] [-o OUTPUT] [-w CUT_WEIGHT] [-f {xgmml,html,json}] [--node_type {all,mesh,relation}] [--weighting_method {freq,npmi}]
                   [--pmid_weight PMID_WEIGHT] [--debug] [--community]

options:
  -h, --help            show this help message and exit
  -i INPUT, --input INPUT
                        Path to the pubtator file
  -o OUTPUT, --output OUTPUT
                        Output path (default: [INPUT FILEPATH].xgmml)
  -w CUT_WEIGHT, --cut_weight CUT_WEIGHT
                        Discard the edges with weight smaller than the specified value (default: 5)
  -f {xgmml,html,json}, --format {xgmml,html,json}
                        Output format (default: html)
  --node_type {all,mesh,relation}
                        Keep specific types of nodes (default: all)
  --weighting_method {freq,npmi}
                        Weighting method for network edge (default: freq)
  --pmid_weight PMID_WEIGHT
                        CSV file for the weight of the edge from a PMID (default: 1)
  --debug               Print debug information
  --community           Divide nodes into distinct communities by the Louvain method
```
